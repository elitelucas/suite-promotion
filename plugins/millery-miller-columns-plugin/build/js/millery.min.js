!function(m,l,t,h){var i=function(e,i){this.elem=e,this.$elem=m(e),this.options=i,this.metadata=this.$elem.data("plugin-options")};i.prototype={public:function(){return{source:null,visibleColumns:3,panelWidth:"75%",panelType:null,transitionDuration:100,showHeaders:!0,searchable:!1,columnSearch:!0,keepState:!1,stateSaveId:null,enableKeyboard:!0,searchLabel:"Search...",backButtonLabel:"Back",closeButtonLabel:"Close",onbeforeinit:function(e){},oninit:function(e){},onnodeclick:function(e,i){return!0},onbeforeappend:function(e,i,n){return!0},onafterappend:function(e,i,n){},onbeforepanelclose:function(e,i){return!0},onafterpanelclose:function(e,i){},onbeforepanelopen:function(e,i){return!0},onafterpanelopen:function(e,i){},onbeforeremove:function(e,i){return!0},onafterremove:function(e){},onbackbutton:function(e){return!0},onbreadcrumb:function(e,i){return!0},columns:[],debug:!1}},private:function(){return{panelTypes:["always","modal","overlay"],scrollHandler:null,ajaxHandler:null,ajaxTimeout:null,currentIndex:0,walkFinished:!1,globalLoadPromise:null,storageData:null,keyboardSelectedNode:null,clickEventFinished:null}},init:function(){return this.config=m.extend(!0,{},this.public(),this.options,this.metadata),this.globals=m.extend(!0,{},this.private()),this.config.debug&&console.time("init "+this.elem.id),this.fixColumnsConfig(),null===this.config.stateSaveId&&(this.config.stateSaveId=this.elem.id),m("body").addClass(this.checkTouch()?"millery-touch":"millery-notouch"),"always"==this.config.panelType&&(this.config.visibleColumns=1),this.config.onbeforeinit(this),this.drawUserInterface(),this.attachEvents(),this.initStorage(this.config.stateSaveId),this.loadData(0,null,null).then(m.proxy(function(){this.addKeyboardNavigation()},this)),this.container.data("millery",this),this.config.oninit(this),(this.elem.millery=this).config.debug&&console.timeEnd("init "+this.elem.id),this},fixColumnsConfig:function(){for(var e={header:"[Not Defined]",sourceType:"json",source:null,idField:null,paginated:!1,pageCount:null,labelField:null,format:function(e,i){return e}},i=0,n=this.config.columns.length;i<n;i++)for(var t in e)0==this.config.columns[i].hasOwnProperty(t)&&(this.config.columns[i][t]=e[t])},drawUserInterface:function(){switch(this.container=m(["<div class='millery-container","always"==this.config.panel?" millery-panel-open":"","' tabindex='-1'>","<div class='millery-top'>","<button type='button' class='millery-back-button' disabled='disabled'><i class='fa fa-chevron-left' style='margin-right: 10px'></i>"+this.config.backButtonLabel+"</button>","<button type='button' class='millery-close-button' style='display: none'><i class='fa fa-times' style='margin-right: 10px'></i>"+this.config.closeButtonLabel+"</button>","<div class='millery-breadcrumbs'></div>",1==this.config.searchable?"<div class='millery-search'><span class='icon'><i class='fa fa-search'></i></span><input type='search' name='millery-search-input' placeholder='"+this.config.searchLabel+"'></div>":"","</div>","<div class='millery-bottom'>","<div class='millery-columns' style='flex: 1;'></div>","<div class='millery-panel'>&nbsp;</div>","</div>","</div>"].join("")).appendTo(this.$elem),this.columnscontainer=this.container.find(".millery-columns"),this.toppart=this.container.find(".millery-top"),this.backbutton=this.toppart.find(".millery-back-button"),this.closebutton=this.toppart.find(".millery-close-button"),this.breadcrumbs=this.toppart.find(".millery-breadcrumbs"),this.panel=this.container.find(".millery-panel"),this.searchInput=this.config.searchable?this.container.find("input[name='millery-search-input']"):null,-1==this.globals.panelTypes.indexOf(this.config.panelType)&&(this.config.panelType=null),this.config.panelType){case"overlay":this.panel.css("width",this.config.panelWidth).addClass("millery-panel-overlay");break;case"modal":this.panel.css("width",this.config.panelWidth).addClass("millery-panel-modal");break;case"always":this.panel.css("flex","0 0 "+this.config.panelWidth).addClass("millery-panel-always");break;default:this.panel.hide()}},appendColumnUL:function(e){var i=m.Deferred(),n=this.columnscontainer.find(".millery-column").length,t=m(["<div class='millery-column' data-index='",n,"' style='z-index: ",100-n,";","flex-basis: calc(100% /",this.config.visibleColumns,"); left: calc(-100% /",this.config.visibleColumns,");'><div class='millery-column-wrapper'>",this.config.showHeaders?"<div class='millery-column-header'>"+(0<e.children("a").length?e.children("a").first().text():this.getText(e))+"</div>":"",this.config.columnSearch?"<div class='millery-column-search'><span class='icon'><i class='fa fa-search'></i></span><input type='search' placeholder='"+this.config.searchLabel+"'></div>":"","<div class='millery-column-content'></div></div></div>"].join(""));return 1==this.config.onbeforeappend(this,t,null)?(t.appendTo(this.columnscontainer).animate({left:"0"},{duration:0==this.globals.walkFinished?0:this.config.transitionDuration,complete:m.proxy(function(){i.resolve(),this.setBackButtonStatus(),this.config.onafterappend(this,t,null)},this)}),[i,t.find(".millery-column-content")]):(i.resolve(),[i,null])},appendColumn:function(e){var i=m.Deferred(),n=this.columnscontainer.find(".millery-column").length,t=m(["<div class='millery-column' data-index='",n,"' style='z-index: ",100-n,";","flex-basis: calc(100% /",this.config.visibleColumns,"); left: calc(-100% /",this.config.visibleColumns,");'><div class='millery-column-wrapper'>",this.config.showHeaders?"<div class='millery-column-header'>"+("function"==typeof e.header?e.header(this.columnscontainer.find(".millery-node-active").last().data("millery-data")):e.header)+"</div>":"",this.config.columnSearch?"<div class='millery-column-search'><span class='icon'><i class='fa fa-search'></i></span><input type='search' placeholder='"+this.config.searchLabel+"'></div>":"","<div class='millery-column-content'></div></div></div>"].join(""));return 1==this.config.onbeforeappend(this,t,e)?(t.appendTo(this.columnscontainer).animate({left:"0"},{duration:0==this.globals.walkFinished?0:this.config.transitionDuration,complete:m.proxy(function(){i.resolve(),this.setBackButtonStatus(),this.config.onafterappend(this,t,e)},this)}),[i,t.find(".millery-column-content")]):(i.resolve(),[i,null])},removeColumn:function(e){var i=m.Deferred(),n=this.columnscontainer.find(".millery-column").eq(e-1).nextAll(".millery-column");return 0<n.length?(totalWidths=0,n.map(function(){totalWidths+=m(this).outerWidth()}),1==this.config.onbeforeremove(this,n)?(n.animate({marginLeft:-99.99999/this.config.visibleColumns+"%"},{duration:0==this.globals.walkFinished?0:this.config.transitionDuration,complete:function(){n.remove(),i.resolve()}}),this.config.onafterremove(this)):i.resolve(),i):i.resolve()},clearColumns:function(){this.columnscontainer.empty(),this.globals.currentIndex=-1},setBackButtonStatus:function(){1==this.columnscontainer.find(".millery-column").length?this.backbutton.attr("disabled","disabled"):this.backbutton.removeAttr("disabled")},setPanelData:function(e){this.panel.html(e)},setBreadcrumbs:function(){var i=this;this.breadcrumbs.empty(),this.columnscontainer.find(".millery-column").each(function(){var e=m(this).find(".millery-node-active").first().text();i.breadcrumbs.append("<div class='millery-breadcrumb'>"+e+"</div>")})},openPanel:function(){null!==this.config.panelType&&"always"!==this.config.panelType&&1==this.config.onbeforepanelopen(this,this.panel)&&(this.container.addClass("millery-panel-open"),this.closebutton.show(),this.backbutton.hide(),this.config.onafterpanelopen(this))},closePanel:function(){null!==this.config.panelType&&"always"!==this.config.panelType&&1==this.config.onbeforepanelclose(this,this.panel)&&(this.container.removeClass("millery-panel-open"),this.closebutton.hide(),this.backbutton.show(),this.config.onafterpanelclose(this,this.panel))},attachEvents:function(){m(t).off("click.millery").on("click.millery",".millery-node",function(){var e=m(this),i=e.parents(".millery-container").first().data("millery"),n=e.parents(".millery-column").first(),t=e.parents(".millery-columns").find(".millery-column"),l=t.index(n);return i.globals.clickEventFinished=new m.Deferred,i.config.keepState&&i.globals.walkFinished&&i.setStorage(l,e.data("id")),m(this).hasClass("millery-node-active")&&t.length>l+1?i.globals.clickEventFinished.resolve():(i.globals.currentIndex=l,n.find(".millery-node").removeClass("millery-node-active"),e.addClass("millery-node-active"),i.removeColumn(l+1).done(function(){e.hasClass("millery-node-parent")?i.loadData(l+1,e.data("id"),e.data("millery-data")):(1==i.config.onnodeclick(i,e,e.data("millery-data"))&&i.openPanel(),i.globals.clickEventFinished.resolve(),i.setBackButtonStatus(),i.setBreadcrumbs())})),!1}),this.backbutton.on("click.millery",function(){var e=m(this).parents(".millery-container").first().data("millery"),i=e.globals.currentIndex;return 0<i&&1==e.config.onbackbutton(this)&&e.removeColumn(i).then(function(){e.setBreadcrumbs(),e.popStorage(),e.setBackButtonStatus(),e.scrollToIndex(i-1)}),!1}),m(l).off("resize.millery").on("resize.millery",function(){return l.milleryResizeTimeout&&clearTimeout(l.milleryResizeTimeout),l.milleryResizeTimeout=setTimeout(function(){m(".millery-container").each(function(){m(this).addClass("millery-no-transition");var e=m(this).data("millery"),i=e.config.transitionDuration;e.config.transitionDuration=0,e.scrollToIndex(e.globals.currentIndex),m(this).removeClass("millery-no-transition"),e.config.transitionDuration=i})},50),!1}),m(t).off("click.millerybreadcrumb").on("click.millerybreadcrumb",".millery-breadcrumb",function(){var e=m(this),i=e.parents(".millery-container").first().data("millery"),n=e.parents(".millery-breadcrumbs").find(".millery-breadcrumb"),t=n.index(e);if(t==n.length-1)return!1;i.container.hasClass("millery-panel-open")&&i.closePanel(),1==i.config.onbreadcrumb(i,e)&&i.removeColumn(t+1).then(function(){i.setBreadcrumbs(),i.scrollToIndex(t)})}),m(t).on("input.millery",".millery-column-search input",function(){var e=m(this),i=new RegExp(e.val(),"i");e.parent(".millery-column-search").next(".millery-column-content").find(".millery-node").each(function(){var e=m(this);i.test(e.text())||0!=e.hasClass("millery-node-active")?e.show():e.hide()})}),1==this.config.searchable&&this.searchInput.on("input.millery",function(){var e=m(this).parents(".millery-container").first().data("millery");e.globals.ajaxTimeout&&clearTimeout(e.globals.ajaxTimeout),e.globals.ajaxTimeout=setTimeout(m.proxy(function(){this.clearColumns(),this.loadData(0,null,null)},e),500)}),this.closebutton.on("click",m.proxy(this.closePanel,this))},appendQuery:function(e,i,n){return e+(0<e.indexOf("?")?"&":"?")+i+"="+n},loadData:function(i,n,e){var t=this.config.searchable?this.searchInput.val():"";if(null!=this.config.source){m(this.config.source).hide(),this.config.showHeaders=!1;var l=null;if(0==i)l=this.config.source;else{l=this.config.source;for(var o=this.columnscontainer.find(".millery-column"),a=o.length,s=0;s<a;s++){var r=m(o[s]),c=r.find(".millery-node-active").first(),d=r.find(".millery-node").index(c);-1==d&&(d=i),l=l.children("li").eq(d).children("ul").first()}}return this.appendDataUL(l,i),(new m.Deferred).resolve()}if(this.config.columns[i]){var h=this.config.columns[i],u=h.hasOwnProperty("formatUrl")&&"function"==typeof h.formatUrl?h.formatUrl(h.source,e):h.source;return this.config.searchable&&""!==t.trim()&&(h.hasOwnProperty("searchUrl")&&(u=h.hasOwnProperty("formatUrl")&&"function"==typeof h.formatUrl?h.formatUrl(h.searchUrl,e):h.searchUrl),u=this.appendQuery(u,h.searchParam,t)),m.getJSON(u,m.proxy(function(e){this.appendData(n,i,e,h)},this))}},appendData:function(a,s,r,c){var e=this.appendColumn(c),d=e[1],i=e[0];m.when(i).then(m.proxy(function(){c.hasOwnProperty("loopPath")&&0!=c.loopPath&&(r=this.getPath(r,c.loopPath));for(var e=0;e<r.length;e++){var i=c.hasOwnProperty("childrenCountField")?"function"==typeof c.childrenCountField?c.childrenCountField(r[e]):r[e][c.childrenCountField]:0,n=null==a&&(void 0===c.parentIdField||null==c.parentIdField||null==r[e][c.parentIdField]||void 0===r[e][c.parentIdField]),t=c.parentIdField!=h&&null!=c.parentIdField&&r[e][c.parentIdField]==a&&null!=a,l=c.hasOwnProperty("dontCheckParent")&&!0===c.dontCheckParent;if(n||t||l){d.append("<div class='millery-node"+(0<i?" millery-node-parent":"")+"' data-column='"+s+"' data-id='"+r[e][c.idField]+"'>"+c.format(r[e][c.labelField],r[e])+(0<i?"<div class='millery-node-more'><i class='fa fa-chevron-right'></i></div>":"")+"</div>");var o=d.find(".millery-node").last();o.data("millery-data",r[e]),this.config.keepState&&0==this.globals.walkFinished&&this.globals.storageData[s]!==h&&r[e][c.idField]==this.globals.storageData[s]&&o.click()}}s>=this.globals.storageData.length-1&&(this.globals.walkFinished=!0),this.globals.walkFinished&&null!=this.globals.clickEventFinished&&this.globals.clickEventFinished.resolve(),this.setBreadcrumbs(),this.scrollToIndex(s)},this))},appendDataUL:function(l,o){var e=this.appendColumnUL(l),a=e[1],i=e[0];m.when(i).then(m.proxy(function(){for(var e=0;e<l.children("li").length;e++){var i=l.children("li:eq("+e+")"),n=i.children("ul").length;a.append("<div class='millery-node"+(0<n?" millery-node-parent":"")+"' data-column='"+e+"' data-id='"+e+"'>"+(0<i.children("a").length?i.children("a").first().text():this.getText(i))+(0<n?"<div class='millery-node-more'><i class='fa fa-chevron-right'></i></div>":"")+"</div>");var t=a.find(".millery-node").last();this.config.keepState&&0==this.globals.walkFinished&&this.globals.storageData[o]!==h&&e==this.globals.storageData[o]&&t.click()}o>=this.globals.storageData.length-1&&(this.globals.walkFinished=!0),this.globals.walkFinished&&null!=this.globals.clickEventFinished&&this.globals.clickEventFinished.resolve(),this.setBreadcrumbs(),this.scrollToIndex(o)},this))},getText:function(e){return e.clone().children().remove().end().text()},addKeyboardNavigation:function(){if(this.config.enableKeyboard){var e=m.proxy(function(e){if("millery-search-input"===m(t.activeElement).prop("name"))return!0;var i=e.which?e.which:e.keyCode;if(null===this.globals.keyboardSelectedNode){if(this.globals.keyboardSelectedNode=this.columnscontainer.find(".millery-node-active").last(),0==this.globals.keyboardSelectedNode.length)return this.globals.keyboardSelectedNode=this.columnscontainer.find(".millery-node").first(),this.globals.keyboardSelectedNode.addClass("millery-node-hover"),!1;this.globals.keyboardSelectedNode.addClass("millery-node-hover")}else if(0==this.globals.keyboardSelectedNode.closest("body").length&&(this.globals.keyboardSelectedNode=this.columnscontainer.find(".millery-node-active").last(),0==this.globals.keyboardSelectedNode.length))return this.globals.keyboardSelectedNode=this.columnscontainer.find(".millery-node").first(),this.globals.keyboardSelectedNode.addClass("millery-node-hover"),!1;var n=null;switch(i){case 37:this.backbutton.click(),this.container.focus();break;case 38:if(0<this.globals.keyboardSelectedNode.prev(".millery-node").length)return n=this.globals.keyboardSelectedNode.prev(".millery-node"),this.globals.keyboardSelectedNode=n,this.columnscontainer.find(".millery-node-hover").removeClass("millery-node-hover"),n.addClass("millery-node-hover"),!1;break;case 39:if(this.globals.keyboardSelectedNode.hasClass("millery-node-parent"))return this.globals.keyboardSelectedNode.click(),this.globals.clickEventFinished.then(m.proxy(function(){var e=this.columnscontainer.find(".millery-column").last();n=e.find(".millery-node").first(),this.globals.keyboardSelectedNode=n,this.columnscontainer.find(".millery-node-hover").removeClass("millery-node-hover"),n.addClass("millery-node-hover")},this)),!1;break;case 40:if(0<this.globals.keyboardSelectedNode.next(".millery-node").length)return n=this.globals.keyboardSelectedNode.next(".millery-node"),this.globals.keyboardSelectedNode=n,this.columnscontainer.find(".millery-node-hover").removeClass("millery-node-hover"),n.addClass("millery-node-hover"),!1;break;case 13:return this.globals.keyboardSelectedNode&&this.globals.keyboardSelectedNode.click(),!1;case 27:return this.closebutton.is(":visible")?this.closebutton.click():this.backbutton.click(),this.container.focus(),!1;case 70:if(e.ctrlKey)return this.searchInput.focus(),!1}},this);this.$elem.off("keydown.millery").on("keydown.millery",e),this.container.off("keydown.millery").on("keydown.millery",e)}},scrollToIndex:function(n){this.requestAnimFrame(m.proxy(function(){var e=this.columnscontainer,i=e.find(".millery-column").eq(n-1);0<i.length&&e.animate({scrollLeft:i.offset().left+i.outerWidth()-e.offset().left+e.scrollLeft()+1},{duration:0==this.globals.walkFinished?0:this.config.transitionDuration,easing:"swing",complete:m.proxy(function(){this.globals.currentIndex=n},this)})},this))},initStorage:function(e){this.globals.storageData=JSON.parse(l.localStorage.getItem(this.config.stateSaveId)),null===this.globals.storageData&&(this.globals.storageData=[])},setStorage:function(e,i){for(var n=[],t=0;t<e;t++)n[t]=this.globals.storageData[t];n[e]=i,this.globals.storageData=n,l.localStorage.setItem(this.config.stateSaveId,JSON.stringify(this.globals.storageData))},popStorage:function(){var e=this.globals.storageData.pop();return l.localStorage.setItem(this.config.stateSaveId,JSON.stringify(this.globals.storageData)),e},getBrowserAnimationEvent:function(){var e,i=t.createElement("fakeelement"),n={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in n)if(i.style[e]!==h)return n[e]},getPath:function(e,i){var n=e;try{i.split(/[\[\]\.]/).filter(function(e){return e}).map(function(e){return e.replace(/^['"]+|['"]+$/g,"")}).forEach(function(e){n=n[e]})}catch(e){n=h}return n},requestAnimFrame:function(e){return"function"==typeof l.requestAnimationFrame?requestAnimationFrame(e):"function"==typeof l.webkitRequestAnimationFrame?webkitRequestAnimationFrame(e):"function"==typeof l.mozRequestAnimationFrame?mozRequestAnimationFrame(e):setTimeout(e,100/6)},cancelAnimFrame:function(e){return"function"==typeof l.cancelAnimationFrame?cancelAnimationFrame(e):"function"==typeof l.webkitCancelAnimationFrame?webkitCancelAnimationFrame(e):"function"==typeof l.mozCancelAnimationFrame?mozCancelAnimationFrame(e):clearTimeout(e)},destroy:function(){},checkTouch:function(){var e=" -webkit- -moz- -o- -ms- ".split(" ");if("ontouchstart"in l||l.DocumentTouch&&t instanceof DocumentTouch)return!0;var i,n=["(",e.join("touch-enabled),("),"heartz",")"].join("");return i=n,l.matchMedia(i).matches}},m.fn.millery=function(e){return this.each(function(){new i(this,e).init()})}}(jQuery,window,document);
//# sourceMappingURL=millery.min.js.map